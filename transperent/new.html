<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Refactored Three.js Scene</title>
    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@v0.157.0/build/three.module.js",
          "three/addons/": "https://unpkg.com/three@v0.157.0/examples/jsm/"
        }
      }
    </script>
  </head>
  <body>
    <script type="module">
      import * as THREE from 'three';
      import { OrbitControls } from 'three/addons/controls/OrbitControls.js'; 
      import { FontLoader } from 'three/addons/loaders/FontLoader.js';
      import { TextGeometry } from 'three/addons/geometries/TextGeometry.js';

      // Initialize scene, camera, and renderer
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      const controls = new OrbitControls(camera, renderer.domElement);
      camera.position.set(1, 1.5, 40);
      camera.lookAt(0, 0, 0);

      // Utility functions
      function createMesh(geometryArgs, materialArgs, position, rotation = { x: 0, y: 0, z: 0 }, colorWrite = true) {
        const geometry = new THREE.BoxGeometry(...geometryArgs);
        const material = new THREE.MeshBasicMaterial({ ...materialArgs });
        const mesh = new THREE.Mesh(geometry, material);

        mesh.position.set(...position);
        mesh.rotation.set(rotation.x, rotation.y, rotation.z);
        mesh.material.colorWrite = colorWrite;

        const edges = new THREE.EdgesGeometry(geometry);
        const line = new THREE.LineSegments(edges, new THREE.LineBasicMaterial({ color: 0x000000 }));
        mesh.add(line);

        scene.add(mesh);
        return mesh;
      }

      function createTextMesh(text, font, size, height, position, rotation = { x: 0, y: 0, z: 0 }) {
        const geometry = new TextGeometry(text, {
          font: font,
          size: size,
          height: height,
        });

        const material = new THREE.MeshPhongMaterial({ color: 'black' });
        const textMesh = new THREE.Mesh(geometry, material);

        textMesh.position.set(...position);
        textMesh.rotation.set(rotation.x, rotation.y, rotation.z);
        scene.add(textMesh);
        return textMesh;
      }

      function createStairs(stepWidth, stepHeight, stepDepth, numSteps, startPosition, direction) {
        const stairsGroup = new THREE.Group();
        for (let i = 0; i < numSteps; i++) {
          const stepGeometry = new THREE.BoxGeometry(stepWidth, stepHeight, stepDepth);
          const stepMaterial = new THREE.MeshBasicMaterial({ color: 'gray' });
          const stepMesh = new THREE.Mesh(stepGeometry, stepMaterial);

          stepMesh.position.set(
            startPosition.x + direction.x * i * stepDepth,
            startPosition.y + i * stepHeight,
            startPosition.z + direction.z * i * stepDepth
          );

          stairsGroup.add(stepMesh);
        }
        scene.add(stairsGroup);
      }

      // Scene setup functions
      function doorsff() {
        const doorPositions = [
          [-2.2, 1.5, 5],
          [-5.2, 1.5, 5],
          [-9, 1.5, 5],
          [-11.8, 1.5, 5],
          [-14, 1.5, 5],
          [-8, 5.5, 5],
          [6, 5.5, -12],
        ];

        doorPositions.forEach(position => {
          createMesh([1.5, 3, 0.1], { color: 'red', transparent: true, opacity: 0.7 }, position, { x: 0, y: 0, z: 0 }, false);
        });
      }

      function walls() {
        const wallData = [
          { geometryArgs: [50, 4, 0.08], position: [0, 0.9, -25] },
          { geometryArgs: [28, 4, 0.08], position: [-10.5, 0.9, 25] },
          { geometryArgs: [14.5, 4, 0.08], position: [17.7, 0.9, 25] },
          { geometryArgs: [0.08, 4, 50], position: [-25, 0.9, 0] },
          { geometryArgs: [0.08, 4, 50], position: [25, 0.9, 0] },
        ];

        wallData.forEach(({ geometryArgs, position }) => {
          createMesh(geometryArgs, { color: 'red', transparent: true, opacity: 0.7 }, position);
        });
      }

      function stairsSetup() {
        createStairs(0.98, 0.4, 1, 6, { x: 7.5, y: 0, z: 10 }, { x: 1, y: 1, z: 0 });
        createStairs(0.98, 0.4, 1, 6, { x: 12.5, y: 2, z: 11 }, { x: -1, y: 1, z: 0 });
        createStairs(0.98, 0.4, 1, 6, { x: 7.5, y: 4, z: 10 }, { x: 1, y: 1, z: 0 });
        createStairs(0.98, 0.4, 1, 6, { x: 12.5, y: 6, z: 11 }, { x: -1, y: 1, z: 0 });
      }

      // Load fonts and create text
      const fontLoader = new FontLoader();
      fontLoader.load('marathi11.json', function (font) {
        createTextMesh('संगणक शास्त्र विभाग', font, 0.3, 0.1, [8, 10, 11.5]);
      });

      fontLoader.load('fonts.json', function (font) {
        const textData = [
          { text: 'OFFICE', position: [-5.2, 2, 5] },
          { text: 'J Yadav', position: [-2.2, 2, 5] },
          { text: 'Head of Department', position: [-9, 2, 5] },
          { text: 'Common Room', position: [-11.8, 2, 5] },
          { text: 'Exam Room', position: [-14, 2, 5] },
          { text: 'D. Kulkarni', position: [6.99, 2, 8] },
          { text: 'OFFICE', position: [7, 2, 5] },
        ];

        textData.forEach(({ text, position }) => {
          createTextMesh(text, font, -0.1, -0.3, position, { x: 0, y: Math.PI / 2, z: 0 });
        });
      });

      // Initialize scene components
      doorsff();
      walls();
      stairsSetup();

      // Render loop
      function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
      }

      animate();
    </script>
  </body>
</html>
